import jsonimport osimport shutilDB_FILE = os.path.join("data", "listings.json")BACKUP_DIR = "backups"PREV_FILE = os.path.join(BACKUP_DIR, "listings_PREV.json")   # قبل آخر حفظCURR_FILE = os.path.join(BACKUP_DIR, "listings_CURR.json")   # آخر نسخة بعد الحفظDEFAULT_DATA = {    "info": {"business_name": "عقارات أبو الحسن", "phones": [], "address": ""},    "categories": {}}def _ensure_dirs():    os.makedirs(os.path.dirname(DB_FILE), exist_ok=True)    os.makedirs(BACKUP_DIR, exist_ok=True)def _ensure_db_file():    _ensure_dirs()    if not os.path.exists(DB_FILE):        with open(DB_FILE, "w", encoding="utf-8") as f:            json.dump(DEFAULT_DATA, f, ensure_ascii=False, indent=2)def _rotate_backups_before_save():    """    قبل ما نحفظ:    - نخلي CURR يصير PREV (إذا موجود)    - وننسخ DB_FILE الحالي إلى CURR (إذا DB_FILE موجود)    النتيجة: دائما عدنا PREV + CURR فقط    """    _ensure_dirs()    # 1) CURR -> PREV    if os.path.exists(CURR_FILE):        shutil.copy2(CURR_FILE, PREV_FILE)    # 2) DB_FILE الحالي -> CURR (قبل ما نكتب الجديد)    if os.path.exists(DB_FILE):        shutil.copy2(DB_FILE, CURR_FILE)def load_data():    _ensure_db_file()    with open(DB_FILE, "r", encoding="utf-8") as f:        return json.load(f)def save_data(data):    _ensure_db_file()    # ✅ خزن قبل التعديل (rotate) بشكل اوتوماتيكي    _rotate_backups_before_save()    # ✅ اكتب الداتا الجديدة    with open(DB_FILE, "w", encoding="utf-8") as f:        json.dump(data, f, ensure_ascii=False, indent=2)    # ✅ بعد الحفظ: خزن النسخة الجديدة كـ CURR (حتى CURR دائمًا = آخر وضع)    shutil.copy2(DB_FILE, CURR_FILE)